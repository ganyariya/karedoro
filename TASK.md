# karedoro 開発タスク

## プロジェクト概要
ポモドーロタイマーの徹底継続を目的としたWails（Go + React/TypeScript）製デスクトップアプリケーション

## 開発フェーズ

### 📋 Phase 1: バックエンド基盤構築（Go） ✅ **完了**

#### 1.1 ドメインモデル設計
- [x] セッション状態の定義（Work/Break/Idle）
- [x] セッション時間の設定構造体（作業25分、休憩5分）
- [x] ドメインロジックのインターフェース設計

#### 1.2 セッション管理コア機能
- [x] タイマー機能の実装（カウントダウン機能）
- [x] セッション状態遷移ロジック
- [x] 一時停止・再開機能
- [x] セッション終了時の処理

#### 1.3 システム連携機能
- [x] Wailsランタイム統合（ウィンドウ制御）
- [x] 全画面表示の強制実装
- [x] OSネイティブ通知システム
- [x] 警告システム（5分間隔）

#### 1.4 Wails Bindings
- [x] フロントエンド向けAPI関数の実装
  - [x] セッション開始関数
  - [x] 一時停止・再開関数
  - [x] セッション状態取得関数

#### 1.5 Wails Events
- [x] リアルタイム状態更新イベント
- [x] タイマー残り時間の配信
- [x] 警告トリガーイベント

### 🎨 Phase 2: フロントエンド基盤構築（React/TypeScript）

#### 2.1 UI設計・実装
- [ ] メインタイマー画面の実装
- [ ] 全画面オーバーレイ画面の実装
- [ ] セッション開始ボタンUIの実装
- [ ] 一時停止・再開ボタンの実装

#### 2.2 状態管理
- [ ] React状態管理の設計
- [ ] Wails Eventsの受信処理
- [ ] UIのリアルタイム更新機能

#### 2.3 音響・通知機能
- [ ] HTML5 Audio API統合
- [ ] セッション開始・終了効果音
- [ ] ポップアップ通知システム

#### 2.4 Wails連携
- [ ] Go関数呼び出しの実装
- [ ] エラーハンドリング
- [ ] TypeScript型定義の整備

### 🎯 Phase 3: コア機能統合

#### 3.1 セッションフロー実装
- [ ] 作業セッション開始→終了フロー
- [ ] 休憩セッション開始→終了フロー
- [ ] セッション間遷移の全画面制御

#### 3.2 強制継続機能
- [ ] セッション終了時の全画面表示強制
- [ ] 他アプリ操作の無効化
- [ ] 警告システムの統合テスト

#### 3.3 ウィンドウ制御
- [ ] フルスクリーンモードの制御
- [ ] ウィンドウリサイズ・最小化の無効化
- [ ] OSレベルイベントハンドリング

#### 3.4 バックグラウンド実行機能 🆕
- [ ] ウィンドウクローズ時の継続動作実装
- [ ] システムトレイ統合（macOS: メニューバー、Windows: タスクトレイ）
- [ ] バックグラウンド状態でのセッション管理
- [ ] セッション終了時の強制ウィンドウ復帰
- [ ] バックグラウンド中の通知システム

### 🧪 Phase 4: テスト・品質保証

#### 4.1 単体テスト
- [ ] ドメインロジックのテスト
- [ ] タイマー機能のテスト
- [ ] セッション状態遷移のテスト

#### 4.2 統合テスト
- [ ] フロントエンド・バックエンド連携テスト
- [ ] Wailsランタイム機能のテスト
- [ ] エンドツーエンドシナリオテスト

#### 4.3 品質確認
- [ ] パフォーマンス検証
- [ ] メモリリーク検証
- [ ] クロスプラットフォーム動作確認

### 🚀 Phase 5: 完成・リリース準備

#### 5.1 最終調整
- [ ] UI/UXの微調整
- [ ] エラーメッセージの日本語化
- [ ] 設定値の最終確認

#### 5.2 ビルド・パッケージング
- [ ] リリースビルドの作成
- [ ] 各OS向けパッケージング
- [ ] インストーラー作成（必要に応じて）

#### 5.3 ドキュメンテーション
- [ ] ユーザーマニュアル作成
- [ ] 開発者向けドキュメント整備
- [ ] README.mdの更新

## 重要な技術的考慮事項

### 🔧 実装上の注意点
1. **ドメイン駆動設計**：コアロジックをドメイン層として分離
2. **Wails特有のAPI**：ランタイム機能を適切に活用
3. **強制力の実装**：OSレベルでのウィンドウ制御
4. **リアルタイム更新**：Wails Eventsを活用した状態同期
5. **バックグラウンド実行**：ウィンドウを閉じてもタイマーが継続動作
   - ウィンドウクローズ時にアプリケーションプロセスは終了せず、バックグラウンドで継続実行
   - システムトレイ（macOS: メニューバー、Windows: タスクトレイ）にアイコンを表示
   - セッション終了時は強制的にウィンドウを復帰させ、全画面表示
   - バックグラウンド中もタイマーと警告システムは正常動作

### 📦 依存関係
- Wails v2
- Go標準ライブラリ
- React 18+
- TypeScript 4.5+
- 設定管理：spf13/viper（将来的な拡張用）

### 🎨 デザインガイドライン
- ミニマリスト・シンプルなデザイン
- ゲーミフィケーション要素は排除
- 統計機能は実装しない
- ポモドーロのコア機能に専念

## 🔍 開発イテレーション品質保証要件

### 必須確認プロセス
**すべての開発タスクにおいて、以下の3つの確認を必須とする：**

#### 1. テスト実行確認 ✅
- **Go バックエンドテスト**
  ```bash
  go test ./...
  ```
- **フロントエンドテスト**（実装後）
  ```bash
  npm test
  ```
- **すべてのテストがPASSすること**
- **新機能に対する適切なテストが追加されていること**

#### 2. ビルド確認 🔨
- **開発モードビルド**
  ```bash
  wails dev
  ```
- **プロダクションビルド**
  ```bash
  wails build
  ```
- **ビルドエラーが発生しないこと**
- **警告メッセージの確認と対応**

#### 3. 動作確認 🎯
- **基本動作の確認**
  - アプリケーションが正常に起動すること
  - 実装した機能が仕様通りに動作すること
  - エラーハンドリングが適切に機能すること
- **UI/UX確認**
  - ユーザーインターフェースが正常に表示されること
  - ボタン・入力フィールドが正常に機能すること
  - 画面遷移が正常に動作すること

### 📋 各フェーズ完了時の確認チェックリスト

#### Phase 1 完了確認
- [ ] ✅ Go テスト実行：`go test ./...` PASS
- [ ] 🔨 ビルド確認：`wails build` 成功
- [ ] 🎯 タイマー機能の基本動作確認
- [ ] 🎯 セッション状態遷移ロジック確認
- [ ] 🎯 ドメインロジックの単体動作確認

#### Phase 2 完了確認
- [ ] ✅ フロントエンド・バックエンド両方のテスト PASS
- [ ] 🔨 開発モード・プロダクションモード両方でビルド成功
- [ ] 🎯 UIコンポーネントの表示確認
- [ ] 🎯 Wails Bindings の動作確認
- [ ] 🎯 音響・通知機能の動作確認

#### Phase 3 完了確認
- [ ] ✅ 統合テスト含む全テスト PASS
- [ ] 🔨 全機能統合後のビルド成功
- [ ] 🎯 完全なセッションフローの動作確認
- [ ] 🎯 全画面強制機能の動作確認
- [ ] 🎯 警告システムの動作確認
- [ ] 🎯 ウィンドウ制御機能の確認

#### Phase 4 完了確認
- [ ] ✅ 全単体・統合・E2Eテスト PASS
- [ ] 🔨 リリースビルドの成功確認
- [ ] 🎯 パフォーマンス・メモリリーク検証
- [ ] 🎯 クロスプラットフォーム動作確認
- [ ] 🎯 長時間動作の安定性確認

#### Phase 5 完了確認
- [ ] ✅ 最終テストスイート PASS
- [ ] 🔨 各OS向けリリースビルド成功
- [ ] 🎯 インストール・実行の動作確認
- [ ] 🎯 ユーザーシナリオ通りの動作確認
- [ ] 🎯 エラーケース対応の確認

### ⚠️ 品質保証ルール

1. **ゼロテスト破綻原則**
   - 既存テストを破綻させる変更は許可しない
   - 新機能追加時は対応するテストも同時に実装

2. **ビルド成功原則**
   - 開発ブランチは常にビルド可能な状態を保つ
   - ビルドエラーが発生した場合は即座に修正

3. **動作確認原則**
   - 機能実装後は必ず手動での動作確認を実施
   - 想定外の動作がある場合は仕様確認・修正を行う

4. **段階的統合原則**
   - 各フェーズ完了時に必ず全体統合テストを実行
   - 問題発見時は該当フェーズに戻って修正

5. **進捗管理原則**
   - TASK.mdのチェックボックスを実際の進捗に合わせてリアルタイム更新
   - 作業開始時にタスクを開始状態に、完了時に完了状態に更新
   - 新たな課題や追加タスクが発見された場合はTASK.mdに追記

6. **定期コミット原則**
   - 意味のある機能単位（サブタスク完了時）で必ずコミット
   - フェーズ完了時には必ずコミット
   - ビルド・テスト通過を確認してからコミット実行

### 🚨 品質保証失敗時の対応

**テスト失敗時：**
- 失敗原因の特定と修正
- 関連テストの見直し
- 修正後の再テスト実行

**ビルド失敗時：**
- エラーログの詳細確認
- 依存関係・設定の見直し
- 段階的な問題切り分け

**動作不具合時：**
- 期待動作と実際の動作の比較
- 仕様書との照合
- 必要に応じて仕様変更の検討

## 📝 開発ワークフロー

### 作業進捗管理
**すべての開発作業において以下のワークフローを必須とする：**

#### 1. タスク開始時
- [ ] TASK.mdの該当チェックボックスを確認
- [ ] 作業内容を明確に把握
- [ ] 関連する既存コードの確認

#### 2. 作業中
- [ ] TASK.mdのチェックボックスをリアルタイム更新
- [ ] 新たな課題や追加作業が発見された場合は即座にTASK.mdに追記
- [ ] 定期的な進捗確認（1時間毎目安）

#### 3. サブタスク完了時
- [ ] ✅ テスト実行確認
- [ ] 🔨 ビルド確認  
- [ ] 🎯 動作確認
- [ ] TASK.mdのチェックボックス更新
- [ ] **意味のある機能単位でコミット実行**

#### 4. フェーズ完了時
- [ ] フェーズ完了確認チェックリストの実行
- [ ] 品質保証要件の完全確認
- [ ] TASK.mdの進捗状況更新
- [ ] **フェーズ完了コミット実行**

### コミット方針

#### コミットタイミング
1. **サブタスク完了時**：機能単位での小さなコミット
2. **フェーズ完了時**：大きな機能群の統合コミット
3. **バグ修正時**：問題解決のタイミングでコミット
4. **リファクタリング時**：コード品質改善のタイミングでコミット

#### コミット前必須確認
- [ ] `go test ./...` 全テスト通過
- [ ] `wails build` ビルド成功
- [ ] 基本機能の動作確認完了
- [ ] TASK.mdの進捗状況が最新

#### コミットメッセージ規則
- **形式**：`動詞 + 概要説明`（例：Add, Update, Fix, Refactor）
- **詳細**：何を実装/修正したかを具体的に記載
- **影響範囲**：変更が及ぼす影響を明記
- **テスト状況**：テスト実行結果を記載

## 開発進捗確認ポイント
- [x] Phase 1完了：基本的なタイマー機能が動作 + 品質保証確認完了
- [ ] Phase 2完了：UIが表示され、基本操作が可能 + 品質保証確認完了
- [ ] Phase 3完了：全画面強制とセッション遷移が動作 + 品質保証確認完了
- [ ] Phase 4完了：安定動作とテスト通過 + 品質保証確認完了
- [ ] Phase 5完了：リリース可能状態 + 最終品質保証確認完了