## ポモドーロ強制継続アプリ karedoro ：最終仕様と開発要件

### 1. アプリの概要
このアプリケーションは、ポモドーロ・テクニックの徹底を目的としたデスクトップアプリです。ユーザーがポモドーロセッションを「絶対に」中断せず、次のセッションへとスムーズに移行できるよう、強力な視覚的・聴覚的フィードバックと強制力を持つ設計です。ゲーミフィケーションや詳細な統計機能は排除し、コア機能に専念します。

### 2. コア機能仕様

#### 2.1. アプリの基本状態
アプリは以下の3つの主要な状態を持ちます。

* **作業セッション中 (Work Session)**
* **休憩セッション中 (Break Session)**
* **待機中 (Idle)**：セッション終了後、次のセッション開始を待っている状態。

#### 2.2. セッションの開始と通知

* **作業セッション開始時:**
    * **トリガー:** 休憩セッション終了後の待機中に、ユーザーが「作業開始」ボタンをクリック。または、アプリ起動時、もしくは「作業セッション開始」ボタンを明示的にクリック。
    * **UI/UX:** 画面右上にポップアップ通知を表示。「作業セッション開始！」などのメッセージとともに、効果音を再生します。ポップアップは数秒で自動的に消えます。
    * **動作:** 設定された作業時間（初期値：25分）のカウントダウンを開始します。

* **休憩セッション開始時:**
    * **トリガー:** 作業セッション終了後の待機中に、ユーザーが「休憩開始」ボタンをクリック。
    * **UI/UX:** 全画面表示が解除され、通常のデスクトップ画面に戻ります。画面右上にポップアップ通知を表示。「休憩セッション開始！」などのメッセージとともに、効果音を再生します。ポップアップは数秒で自動的に消えます。
    * **動作:** 設定された休憩時間（初期値：5分）のカウントダウンを開始します。

#### 2.3. セッションの終了と全画面強制表示

* **作業セッション終了時:**
    * **トリガー:** 作業セッションのカウントダウンが完了。
    * **UI/UX:** 画面全体が強制的に覆われるように**全画面表示（フルスクリーンモード）**に切り替わります。他のアプリケーション操作はできなくなります。
    * 全画面表示の中央に以下のボタンとメッセージを表示します。
        * 「休憩セッションを開始」ボタン
        * 「休憩をスキップして作業セッションへ」ボタン
        * 「ポモドーロ完了！休憩しましょう！」などのメッセージを大きく表示します。
    * 効果音を再生し、セッション終了を強く通知します。
    * **動作:** アプリは「待機中」状態に移行し、次のユーザー操作を待ちます。この状態から5分経過するごとに、効果音とポップアップによる警告を開始します。

* **休憩セッション終了時:**
    * **トリガー:** 休憩セッションのカウントダウンが完了。
    * **UI/UX:** 画面全体が強制的に覆われるように**全画面表示（フルスクリーンモード）**に切り替わります。他のアプリケーション操作はできなくなります。
    * 全画面表示の中央に以下のボタンとメッセージを表示します。
        * 「作業セッションを開始」ボタン
        * 「休憩終了！作業に戻りましょう！」などのメッセージを大きく表示します。
    * 効果音を再生し、セッション終了を強く通知します。
    * **動作:** アプリは「待機中」状態に移行し、次のユーザー操作を待ちます。この状態から5分経過するごとに、効果音とポップアップによる警告を開始します。

#### 2.4. セッションの一時停止機能

* **トリガー:** 作業セッション中または休憩セッション中に、ユーザーが「一時停止」ボタン（またはショートカットキー）をクリック。
* **UI/UX:** セッションの残り時間が停止し、UI上に「一時停止中」であることを明確に表示します。残り時間の下に「再開」ボタンを表示します。
* **動作:** 一時停止中に時間経過による警告は行いません。ユーザーが「再開」ボタンをクリックすると、停止していた残り時間からカウントダウンを再開します。

#### 2.5. 警告機能（待機中状態）

* **トリガー:** 作業セッション終了後、または休憩セッション終了後の全画面表示中に、ユーザーが「次を始める」ボタン（「休憩セッションを開始」「休憩をスキップして作業セッションへ」「作業セッションを開始」のいずれか）を5分間触らないごとに発動。
* **UI/UX:** 画面右上に、効果音を伴うポップアップ通知を表示します。メッセージ例：「まだ次のセッションを開始していません！」「時間です！作業に戻りましょう！」ポップアップは数秒で自動的に消えます。
* **動作:** ユーザーが次のセッションを開始するボタンをクリックするまで、5分間隔で警告を繰り返します。

#### 2.6. 作業時間・休憩時間の変数化
ポモドーロの作業時間および休憩時間は、内部的に変数として保持し、変更可能な構造とします。ただし、初期リリース時点ではユーザー向けの設定画面は実装せず、これらの値はコード内で固定値（作業25分、休憩5分）として扱います。設定画面の追加は将来の機能拡張とします。

### 3. 技術要件

#### 3.1. アプリケーションフレームワーク
**Wails** を使用し、macOS / Windows / Linux のマルチプラットフォームで動作させます。

#### 3.2. 言語・技術スタック

* **バックエンド（Go）:**
    * 言語: **Go**
    * 役割: アプリケーションのコアロジック（時間管理、セッション状態遷移、警告ロジックなど）、システムとの連携（通知、全画面表示制御など）を担います。
* **フロントエンド（React / TypeScript）:**
    * 言語: **TypeScript**
    * フレームワーク: **React** (ビューの描画に専念)
    * 役割: UIの描画、ユーザー入力の受付、Goバックエンドへのイベント通知を行います。

#### 3.3. アーキテクチャ
DDD (Domain-Driven Design) の概念を意識して実装します。コアロジックはドメイン層としてGoバックエンド内に切り出し、UI層（React）から分離します。

#### 3.4. テスト
意味のある単位でテストを実装します。特にコアロジック（時間管理、セッション状態遷移、警告ロジックなど）は、CLIから動作検証が容易な形でテストが実行できるようにします。過剰なテストコードは不要です。

#### 3.5. デザイン
ミニマリスト・シンプルな見た目を志向します。CSSフレームワークは自由ですが、デザインガイドラインに沿って選定・利用します。

### 4. 考慮事項

#### Wails特有のAPI利用:
* **全画面表示・ウィンドウ操作の無効化:** Wailsのランタイム機能（`runtime.WindowSetFullscreen`, `runtime.WindowSetSize`, `runtime.WindowSetResizable`, `runtime.WindowSetMinSize`など）を利用して、ウィンドウの全画面表示制御、リサイズ不可、最小化不可などの制限を実装します。ユーザーが強制的にアプリを閉じたり最小化したりできないように、OSレベルのイベントハンドリング（例: Windowsのメッセージフック、macOSのイベントモニタリング）もGo側で検討し、WailsのAPIを通じて連携させる必要があるかもしれません。
* **通知・効果音:** Go側でOSネイティブの通知API（GoのライブラリやFyneなどのUIフレームワークの通知機能を利用検討）を呼び出し、Wailsの`runtime.Notification`またはカスタムイベントを通じてフロントエンドに通知を連携させます。効果音は、フロントエンド（React）でHTML5のAudio APIを使用して再生します。
* **フロントエンドとバックエンドの連携 (Wails Bindings & Events):**
    * **Wails Bindings:** フロントエンド (TypeScript/React) からGoの関数を直接呼び出すためにWails Bindingsを使用します。セッション開始・停止、一時停止・再開などのユーザー操作は、Goの公開関数として提供します。
    * **Wails Events:** Goバックエンドからフロントエンド (TypeScript/React) にセッションの状態更新、タイマーの残り時間、警告のトリガーなどを通知するためにWails Eventsを使用します。これにより、リアルタイムなUIの更新を実現します。

#### 永続化:
ポモドーロの時間設定（初期値は固定だが、将来的にはユーザー設定）は、Goの標準ライブラリ（`os`, `encoding/json`など）や、設定管理用のGoライブラリ（`spf13/viper`など）を使用して永続化することを考慮します。
