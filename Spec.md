## ポモドーロ強制継続アプリ karedoro ：最終仕様と開発要件（ebitengine版）

### 1. アプリの概要
このアプリケーションは、ポモドーロ・テクニックの徹底を目的としたデスクトップアプリです。ユーザーがポモドーロセッションを「絶対に」中断せず、次のセッションへとスムーズに移行できるよう、強力な視覚的・聴覚的フィードバックと強制力を持つ設計です。ゲーミフィケーションや詳細な統計機能は排除し、コア機能に専念します。

### 2. コア機能仕様

#### 2.1. アプリの基本状態
アプリは以下の3つの主要な状態を持ちます。

* **作業セッション中 (Work Session)**
* **休憩セッション中 (Break Session)**
* **待機中 (Idle)**：セッション終了後、次のセッション開始を待っている状態。

#### 2.2. セッションの開始と通知

* **作業セッション開始時:**
    * **トリガー:** 休憩セッション終了後の待機中に、ユーザーが「作業開始」ボタンをクリック。または、アプリ起動時、もしくは「作業セッション開始」ボタンを明示的にクリック。
    * **UI/UX:** beeepを使用してシステム通知ポップアップを表示。「作業セッション開始！」などのメッセージとともに、ebiten/oto で効果音を再生します。
    * **動作:** 設定された作業時間（初期値：25分）のカウントダウンを開始します。

* **休憩セッション開始時:**
    * **トリガー:** 作業セッション終了後の待機中に、ユーザーが「休憩開始」ボタンをクリック。
    * **UI/UX:** 全画面表示が解除され、通常のウィンドウサイズに戻ります。beeepを使用してシステム通知ポップアップを表示。「休憩セッション開始！」などのメッセージとともに、ebiten/oto で効果音を再生します。
    * **動作:** 設定された休憩時間（初期値：5分）のカウントダウンを開始します。

#### 2.3. セッションの終了と全画面強制表示

* **作業セッション終了時:**
    * **トリガー:** 作業セッションのカウントダウンが完了。
    * **UI/UX:** ebiten のウィンドウが強制的に**全画面表示（フルスクリーンモード）**に切り替わります。他のアプリケーション操作はできなくなります。
    * 全画面表示の中央に以下のボタンとメッセージを表示します。
        * 「休憩セッションを開始」ボタン
        * 「休憩をスキップして作業セッションへ」ボタン
        * 「ポモドーロ完了！休憩しましょう！」などのメッセージを大きく表示します。
    * ebiten/oto で効果音を再生し、セッション終了を強く通知します。
    * **動作:** アプリは「待機中」状態に移行し、次のユーザー操作を待ちます。この状態から5分経過するごとに、効果音とbeeepによるシステム通知による警告を開始します。

* **休憩セッション終了時:**
    * **トリガー:** 休憩セッションのカウントダウンが完了。
    * **UI/UX:** ebiten のウィンドウが強制的に**全画面表示（フルスクリーンモード）**に切り替わります。他のアプリケーション操作はできなくなります。
    * 全画面表示の中央に以下のボタンとメッセージを表示します。
        * 「作業セッションを開始」ボタン
        * 「休憩終了！作業に戻りましょう！」などのメッセージを大きく表示します。
    * ebiten/oto で効果音を再生し、セッション終了を強く通知します。
    * **動作:** アプリは「待機中」状態に移行し、次のユーザー操作を待ちます。この状態から5分経過するごとに、効果音とbeeepによるシステム通知による警告を開始します。

#### 2.4. セッションの一時停止機能

* **トリガー:** 作業セッション中または休憩セッション中に、ユーザーが「一時停止」ボタン（またはキーボードショートカット）をクリック。
* **UI/UX:** セッションの残り時間が停止し、UI上に「一時停止中」であることを明確に表示します。残り時間の下に「再開」ボタンを表示します。
* **動作:** 一時停止中に時間経過による警告は行いません。ユーザーが「再開」ボタンをクリックすると、停止していた残り時間からカウントダウンを再開します。

#### 2.5. 警告機能（待機中状態）

* **トリガー:** 作業セッション終了後、または休憩セッション終了後の全画面表示中に、ユーザーが「次を始める」ボタン（「休憩セッションを開始」「休憩をスキップして作業セッションへ」「作業セッションを開始」のいずれか）を5分間触らないごとに発動。
* **UI/UX:** beeepを使用してシステム通知ポップアップを表示し、ebiten/oto で効果音を再生します。メッセージ例：「まだ次のセッションを開始していません！」「時間です！作業に戻りましょう！」
* **動作:** ユーザーが次のセッションを開始するボタンをクリックするまで、5分間隔で警告を繰り返します。

#### 2.6. 作業時間・休憩時間の変数化
ポモドーロの作業時間および休憩時間は、内部的に変数として保持し、変更可能な構造とします。ただし、初期リリース時点ではユーザー向けの設定画面は実装せず、これらの値はコード内で固定値（作業25分、休憩5分）として扱います。設定画面の追加は将来の機能拡張とします。

### 3. 技術要件

#### 3.1. アプリケーションフレームワーク
**ebitengine v2** を使用し、macOS / Windows / Linux のマルチプラットフォームで動作させます。

#### 3.2. 言語・技術スタック

* **言語:** **Go** のみ
* **ゲームエンジン:** **ebitengine v2** (UI描画、イベント処理、ウィンドウ管理)
* **音声:** **ebiten/oto** (効果音・BGM再生)
* **システム通知:** **beeep** (OSネイティブ通知)

#### 3.3. アーキテクチャ
DDD (Domain-Driven Design) の概念を意識して実装します。コアロジック（ドメイン層）とUI層を分離し、以下の構造とします：

* **ドメイン層:** セッション管理、時間管理、状態遷移ロジック
* **アプリケーション層:** ドメインロジックの調整、外部システムとの連携
* **プレゼンテーション層:** ebitengine による UI描画、ユーザー入力処理

#### 3.4. テスト
意味のある単位でテストを実装します。特にコアロジック（時間管理、セッション状態遷移、警告ロジックなど）は、CLIから動作検証が容易な形でテストが実行できるようにします。過剰なテストコードは不要です。

#### 3.5. デザイン
ミニマリスト・シンプルな見た目を志向します。ebitengine の描画機能を使用して、シンプルで機能的なUIを実装します。

### 4. 実装における考慮事項

#### 4.1. ebitengine特有の実装:

* **全画面表示・ウィンドウ制御:**
    * `ebiten.SetFullscreen(true)` でフルスクリーン表示を制御
    * `ebiten.SetWindowClosingHandled(true)` でウィンドウクローズイベントをハンドリング
    * ウィンドウクローズが試行されてもアプリは終了せず、バックグラウンドで動作継続

* **ウィンドウのバックグラウンド動作:**
    * ユーザーがウィンドウを閉じようとしても、アプリはバックグラウンドで動作し続ける
    * タイマーは継続し、必要に応じてシステム通知で警告を行う
    * タスクトレイアイコンの実装も検討（将来的な機能拡張）

* **音声システム:**
    * `ebiten/oto` を使用して効果音やBGMを再生
    * WAVやOGG形式の音声ファイルをアセットとして組み込み
    * セッション開始・終了時、警告時に適切な効果音を再生

* **システム通知:**
    * `beeep` ライブラリを使用してOSネイティブの通知を表示
    * セッション開始・終了、警告時にシステム通知ポップアップを表示
    * クロスプラットフォーム対応（Windows、macOS、Linux）

#### 4.2. ユーザー体験の強制力:

* **セッション中の中断防止:**
    * 全画面表示時は他のアプリケーションへの切り替えを困難にする
    * ウィンドウクローズを無効化し、強制終了以外での中断を防ぐ

* **継続の強制:**
    * セッション終了後の待機状態で、定期的な警告により次のセッション開始を促す
    * バックグラウンド動作により、ウィンドウを閉じても通知は継続

#### 4.3. 永続化:
ポモドーロの時間設定（初期値は固定だが、将来的にはユーザー設定）は、Goの標準ライブラリ（`os`, `encoding/json`など）を使用して設定ファイルとして永続化することを考慮します。

#### 4.4. パッケージング:
各プラットフォーム向けの実行可能ファイルは、ebitengine のビルド機能を使用して生成します。必要に応じて、音声ファイルなどのアセットを実行ファイルに埋め込みます。